\section{Results}\label{sec:results}
\newcommand{\resultspath}{tex/results}

\newcommand{\pridentplot}[5]{
\addplot+[only marks, fill opacity=0.2, 
	discard if not={Method}{#1}, 
	discard if not={Model}{#2}, 
	discard if not={Category}{#3},
	discard if not={HistThreshold}{#4}
] table [x=Recall, y=Precision, col sep=comma] {\resultspath/kp-identification.csv};
\addlegendentry{#5}
}

\newcommand{\prlabelplot}[6] {
\addplot+[only marks, fill opacity=0.2,
	discard if not={Method}{#1},
	discard if not={Model}{#2},
	discard if not={Category}{#3},
	discard if not={HistThreshold}{#4},
	discard if not={Label}{#5}
] table [x=Recall, y=Precision, col sep=comma] {\resultspath/kp-labelling.csv};
\addlegendentry{#6}
}

% Tikz graph for identification
% #1 - Histogram threshold
% #2 - Model used (mature/junveile)
\newcommand{\pridentgraph}[3]{
\begin{tikzpicture}[scale=0.7]
\begin{axis}[
	title = {\textbf{Histogram threshold of #2}},
	legend pos=outer north east,
	legend entries={
		Graph method on mature lobsters;,
		Label method on mature lobsters;,
		Graph method on juvenile lobsters;,
		Label method on juvenile lobsters
	},
	legend to name=#3,
	xlabel={Recall},
	xmin=0,xmax=1,
	ylabel={Precision},
	ymin=0,ymax=1
]

\pridentplot{graph}{#1}{mature}{#2}{Graph method on mature lobsters}
\pridentplot{model}{#1}{mature}{#2}{Label method on mature lobsters}
\pridentplot{graph}{#1}{juvenile}{#2}{Graph method on juvenile lobsters}
\pridentplot{model}{#1}{juvenile}{#2}{Label method on juvenile lobsters}

\end{axis}
\end{tikzpicture}
}

% Tikz graph for labelling
% #1 - Histogram threshold
% #2 - Model used (mature/juvenile)
% #3 - Label
\newcommand{\prlabelgraph}[4]{
\begin{tikzpicture}[scale=0.7]
\begin{axis}[
	title = {\textbf{Histogram threshold of #2}},
	legend pos=outer north east,
	legend entries={
		Graph method on mature lobsters;,
		Label method on mature lobsters;,
		Graph method on juvenile lobsters;,
		Label method on juvenile lobsters
	},
	legend to name=#4,
	xlabel={Recall},
	xmin=0,xmax=1,
	ylabel={Precision},
	ymin=0,ymax=1
]

\prlabelplot{graph}{#1}{mature}{#2}{#3}{Graph method on mature lobsters}
\prlabelplot{model}{#1}{mature}{#2}{#3}{Label method on mature lobsters}
\prlabelplot{graph}{#1}{juvenile}{#2}{#3}{Graph method on juvenile lobsters}
\prlabelplot{model}{#1}{juvenile}{#2}{#3}{Label method on juvenile lobsters}

\end{axis}
\end{tikzpicture}
}

\newcommand{\fourplot}[3]{
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.3}{#3}
\end{minipage}
%
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.5}{#3}
\end{minipage}
\\
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.7}{#3}
\end{minipage}
%
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.9}{#3}
\end{minipage}
}

\newcommand{\fourplotlabel}[4]{
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.3}{#3}{#4}
\end{minipage}
%
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.5}{#3}{#4}
\end{minipage}
\\
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.7}{#3}{#4}
\end{minipage}
%
\begin{minipage}{0.45\textwidth}
	#1{#2}{0.9}{#3}{#4}
\end{minipage}
}


To evaluate how well this method of recreating lobster graphs performs, precision and recall metrics were initially used. The goal of using precision and recall is too see what kind of trade-off there is between the relevant keypoints detected in all detected keypoints (precision) and the relevant keypoints detected in all relevant keypoints (recall). Next, the F1 score is computed to get the harmonic mean of precision and recall. This allows the best labelling and colour histogram thresholds to be found. Finally, by applying a (metric TODO) on the models, images from the rest of the dataset are classified as either mature or juvenile and the results compared to Abdallah's results \cite{lobster-thesis}.
\n

\subsection{Precision and recall}
The evaluation for precision and recall is split into two evaluations, one for the performance of identifying correct keypoints and the second for the performance of keypoint labelling. The evaluations are split up into two parts because defining false positives and false negatives when evaluating both aspects together is a difficult problem, the key issue being an overlap between false positives and false negatives for correctly detected but mislabelled keypoints. For example, if a keypoint has been correctly identified and labelled as a \textit{claw} but is actually an \textit{arm}, then it should be a false positive because the labelling is incorrect. However, it should also be a false negative because correct \textit{arm} labelling was missed. Because of these difficult definitions, it made sense to split the precision and recall evaluation into two separate parts where the false positives and false negatives could be clearly defined. 

\subsubsection{Keypoint identification}
First, the precision and recall metrics were calculated for keypoint identification to see how many keypoints from the annotated images could be re-identified in the final graph. The labels of each keypoint and the edges between them are not taken into account for these results. The precision and recall for this evaluation is defined as follows:
\begin{align}
\text{Precision} &= \frac{\text{Correctly detected keypoints}}{\text{Correctly detected keypoints} + \text{Incorrectly detected keypoints}} 
\\[10pt]
\text{Recall} &= \frac{\text{Correctly detected keypoints}}{\text{Correctly detected keypoints} + \text{Missed keypoints in annotation}}
\end{align}


\begin{figure}[H]
\centering
\fourplot{\pridentgraph}{mature}{legend:prident}
\ref{legend:prident}
\caption{Precision/recall graphs with the mature model with varying label thresholds.}
\end{figure}

\begin{figure}[H]
\centering
\fourplot{\pridentgraph}{juvenile}{legend:prident}
\ref{legend:prident}
\caption{Precision/recall graphs with the juvenile model with varying label thresholds.}
\end{figure}

\subsection{Keypoint labelling}


\begin{itemize}
\item True positive - Correctly labelled keypoints
\item False positive - Incorrectly labelled keypoints
\item False negative - Missed labels, eg if 2 claws and only 1 was found/labelled
\item True negative - 
\end{itemize}



%\begin{figure}[H]
%\centering
%\fourplotlabel{\prlabelgraph}{juvenile}{claw}{legend:prlabel}
%\ref{legend:prlabel}
%\caption{Precision/recall graphs with the juvenile model for label ``claw". }
%\end{figure}
%
%\begin{figure}[H]
%\centering
%\fourplotlabel{\prlabelgraph}{juvenile}{arm}{legend:prlabel}
%\ref{legend:prlabel}
%\caption{Precision/recall with juvenile model for label ``arm"}
%\end{figure}
%
%\begin{figure}[H]
%\centering
%\fourplotlabel{\prlabelgraph}{juvenile}{tail}{legend:prlabel}
%\ref{legend:prlabel}
%\caption{Precision/recall with juvenile model for label ``tail"}
%\end{figure}
%
%\begin{figure}[H]
%\centering
%\fourplotlabel{\prlabelgraph}{juvenile}{tail}{legend:prlabel}
%\ref{legend:prlabel}
%\caption{Precision/recall with juvenile model for label ``head"}
%\end{figure}

Problem with recall for labelling is false negatives very low as only 1 or 2 labels are in annotated set. 


\subsection{Classification}

